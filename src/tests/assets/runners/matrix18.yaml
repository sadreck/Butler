name: Wheel

on:
  workflow_dispatch:
    inputs:
      package_version:
        required: true
        type: string
        description: DeepGNN version to put in wheel

jobs:
  wheel-linux:
    name: Linux ${{ matrix.os }}, ${{ matrix.arch.name }}, Python ${{ matrix.ver }}
    runs-on: ${{ matrix.arch.runs-on }}
    container:
      image: quay.io/pypa/${{ matrix.os }}_${{ matrix.arch.python-name }}
      # Don't run as root within the container.
      # Neither Git nor Bazel appreciates that.
      # 1001 is the GitHub Actions runner user.
      options: --init --user 1001
    strategy:
      fail-fast: false
      matrix:
        arch:
          - { name: X64,   python-name: x86_64,  runs-on: [ ubuntu-latest ] }
          - { name: ARM64, python-name: aarch64, runs-on: [ ubuntu-24.04-arm ] }
        os: [ manylinux_2_28 ]
        ver: [ '3.9', '3.10', '3.11', '3.12', '3.13' ]
    env:
      BAZELISK_GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      PYTHON: /usr/local/bin/python${{ matrix.ver }}
      # Bazel fails if the username is unknown.
      USER: runner
    steps:
      - uses: actions/checkout@v4.2.2
